<!DOCTYPE html>
<html>
    <body>
        <video id="target" controls=false muted autoplay disablepictureinpicture></video>
        <button id="btn">request PiP</button>
        <canvas id="canvas"></canvas>
        <script>
            const target = document.getElementById('target');
            const source = document.createElement('canvas');
            const ctx = source.getContext('2d');
            const dpi = window.devicePixelRatio || 1;
            const scale = 2; // Adjust as needed

            source.width = 300 * dpi;
            source.height = 20 * dpi;

            ctx.font = `${15 * dpi}px Arial`;
            ctx.fillStyle = "white"; // Set text color to white
            ctx.textAlign = "left";
            ctx.textBaseline = "middle";
            ctx.imageSmoothingEnabled = true;

            function updateCanvas() {
                const formattedTime = new Date().toLocaleTimeString('en-US', { timeStyle: 'medium' });
                ctx.clearRect(0, 0, source.width, source.height);
                ctx.fillText(formattedTime, 10 * dpi, source.height / 2);
                requestAnimationFrame(updateCanvas);
            }

            updateCanvas();

            const stream = source.captureStream();
            target.srcObject = stream;

            // Attempt to request Picture in Picture immediately on load
            target.requestPictureInPicture();

            if (typeof target.webkitSupportsPresentationMode === 'function' &&
                target.webkitSupportsPresentationMode('picture-in-picture')) {
                // Additional code here if needed
            }
        </script>
    </body>
</html>