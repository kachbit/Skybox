<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
      body {
        text-align: center; /* Center all body elements horizontally */
      }


      #container {
        border-width: 9px;
        border-style: solid dashed solid dashed;
        border-color: slategray;
        padding: 9px;
        text-align: center;
        width: fit-content;
        max-width: 100%;
        margin: auto; /* Center the container horizontally */
      }

      #btn {
        /* Style for the button */
      }

      .video-container,
      .canvas-container {

        max-width: 100%;
        display: inline-block;
        margin: 10px; /* Adjust as needed */
      }
      .capa {
        margin-bottom: 0px;font-family: arial;
        padding:12px;
        background: rgb(126,144,149);
        background: linear-gradient(90deg, rgba(126,144,149,1) 0%, rgba(126,144,149,0.8421569311318278) 63%, rgba(126,131,149,1) 100%);
        border-radius: 10px;
        margin:5px;
        width:fit-content;
        display:inline-block;
        color:white;
        margin-bottom:-9px;
        
      }
 
    </style>
  </head>
  <body>
    <div id="container">
      <div class="video-container">
        <div class="capa" onclick="target.style.width === '0px' ? target.style.width = '' : target.style.width = '0px' ">video pip src. click here if not working:</div><br>
        <video
          id="target"
          style="background: black;border-radius:15px;border: 5px dotted green;max-width: 100%;"
          controls=false
          muted
        >
          <canvas
            id="canvas"
            style="background-color: black; border-radius: 60px; cursor: pointer;max-width: 100%;"
            onclick="initiatePiP()"
          ></canvas>
        </video>
      </div>

      <!-- First Canvas -->

      <div class="canvas-container">
        <div class="capa" onclick="destinationCanvas.style.visibility === 'hidden' ? destinationCanvas.style.visibility = 'visible' : destinationCanvas.style.visibility = 'hidden'">Canvas mimicker node. live previewer:</div><br>
        <canvas
          id="destinationCanvas"
          style="background-color: black; border-radius: 15px;border: 5px dotted gray;max-width: 100%;"
        ></canvas>
      </div>
    </div>
    <br />
    <button id="btn" onclick="initiatePiP()">Request PiP</button>

    <script>
      const target = document.getElementById("target");
      const canvas = document.getElementById("canvas");
      const destinationCanvas = document.getElementById("destinationCanvas");
      const dpi = window.devicePixelRatio || 1;
      let displayTime = false;

      canvas.width = 300 * dpi;
      canvas.height = 60 * dpi;

      destinationCanvas.width = 300 * dpi;
      destinationCanvas.height = 60 * dpi;

      const ctx = canvas.getContext("2d");
      const destCtx = destinationCanvas.getContext("2d");

      ctx.font = `${15 * dpi}px Arial`;
      ctx.fillStyle = "white"; // Set text color to white
      ctx.textAlign = "left";
      ctx.textBaseline = "middle";
      ctx.imageSmoothingEnabled = true;

      function updateCanvas() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        destCtx.clearRect(
          0,
          0,
          destinationCanvas.width,
          destinationCanvas.height
        );

        if (displayTime) {
          const formattedTime = new Date().toLocaleTimeString("en-US", {
            timeStyle: "medium",
          });
          ctx.fillText(formattedTime, 10 * dpi, canvas.height / 2);
          destCtx.drawImage(canvas, 0, 0); // Mimic the first canvas
        } else {
          ctx.fillText("Enable PiP", 10 * dpi, canvas.height / 2);
        }
        requestAnimationFrame(updateCanvas);
      }

      updateCanvas();

      const stream = canvas.captureStream();
      target.srcObject = stream;

      function requestPiP() {
        if (typeof target.requestPictureInPicture === "function") {
          target.requestPictureInPicture();
        }
      }

      function initiatePiP() {
        requestPiP(); // Request PiP if available
        target.play(); // Play video
        displayTime = true; // Enable displaying time on canvas
      }
      function resizePiP() {
        const width = document.querySelector('#text1').value;
        const height = document.querySelector('#text2').value;
        canvas.width = width * dpi;
        canvas.height = height * dpi;
        destinationCanvas.width = width * dpi;
        destinationCanvas.height = height * dpi;
        ctx.font = `${15 * dpi}px Arial`;
        ctx.fillStyle = "white"; // Set text color to white
        ctx.textAlign = "left";
        ctx.textBaseline = "middle";
        ctx.imageSmoothingEnabled = true;
      }
      // Set a source for the video
      target.src = "your_video_source.mp4"; // Replace 'your_video_source.mp4' with the actual video source

      if (
        typeof target.webkitSupportsPresentationMode === "function" &&
        target.webkitSupportsPresentationMode("picture-in-picture")
      ) {
        // Additional code here if needed
      }
    </script><br>
    width: <input id="text1"><br>
    height: <input id="text2"><br>
    <button onclick="resizePiP()">Resize</button><br>
    <script>

    </script>
  </body>
</html>
